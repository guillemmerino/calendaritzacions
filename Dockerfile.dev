FROM python:3.11-slim

# Paquets útils per compilar rodes si cal
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential gcc && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Virtualenv persistent a un volum per no reinstal·lar cada cop
ENV VENV_PATH=/venv
RUN python -m venv $VENV_PATH
ENV PATH="$VENV_PATH/bin:$PATH"

# Entrypoint que instal·la deps si canvia requirements.txt
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# Per defecte, la font es muntarà per volum (no la copiem)
ENTRYPOINT ["/entrypoint.sh"]
CMD ["python", "main.py"]   # canvia-ho si cal
